/*
 * jQuery Address Plugin v1.2
 * http://www.asual.com/jquery/address/
 *
 * Copyright (c) 2009-2010 Rostislav Hristov
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Date: 2010-03-03 21:24:30 +0200 (Wed, 03 Mar 2010)
 */
(function(d){d.address=function(){var z=function(a){d(d.address).trigger(d.extend(d.Event(a),function(){for(var b={},g=d.address.parameterNames(),e=0,p=g.length;e<p;e++)b[g[e]]=d.address.parameter(g[e]);return{value:d.address.value(),path:d.address.path(),pathNames:d.address.pathNames(),parameterNames:g,parameters:b,queryString:d.address.queryString()}}.call(d.address)))},t=function(a,b,g){if(g||b)d(d.address).bind(a,g||b,g&&b);return d.address},u=function(){var a=c.href.indexOf("#");return a!=-1?
S(H(c.href.substr(a+1))):""},T=function(){return"javascript"},U=function(a,b){if(l.strict)a=b?a.substr(0,1)!="/"?"/"+a:a:a==""?"/":a;return a},I=function(a,b){return s&&c.protocol=="file:"?b?f.replace(/\?/,"%3F"):f.replace(/%253F/,"?"):a},V=function(a){for(var b,g,e=0,p=a.childNodes.length;e<p;e++){if(a.childNodes[e].src)b=String(a.childNodes[e].src);if(g=V(a.childNodes[e]))b=g}return b},F=function(){if(!J){var a=u(),b=f!=a;if(A&&m<523){if(B!=D.length){B=D.length;if(typeof v[B-1]!=w)f=v[B-1];E(h)}}else if(s&&
m<7&&b)c.reload();else if(b){f=a;E(h)}}},E=function(a){z("change");z(a?"internalChange":"externalChange");C(W,10)},W=function(){var a=(c.pathname+(/\/$/.test(c.pathname)?"":"/")+d.address.value()).replace(/\/\//,"/").replace(/^\/$/,""),b=window[l.tracker];if(typeof b==K)b(a);else if(typeof _gaq!=w&&typeof _gaq.push==K)_gaq.push(["_trackPageview",a]);else if(typeof pageTracker!=w&&typeof pageTracker._trackPageview==K)pageTracker._trackPageview(a);else typeof urchinTracker==K&&urchinTracker(a)},X=function(){var a=
i.contentWindow.document;a.open();a.write("<html><head><title>"+j.title+"</title><script>var "+q+' = "'+u()+'";<\/script></head></html>');a.close()},Z=function(){if(!Y){Y=k;if(s&&m<8){var a=j.getElementsByTagName("frameset")[0];i=j.createElement((a?"":"i")+"frame");if(a){a.insertAdjacentElement("beforeEnd",i);a[a.cols?"cols":"rows"]+=",0";i.src=T()+":"+h;i.noResize=k;i.frameBorder=i.frameSpacing=0}else{i.src=T()+":"+h;i.style.display="none";j.body.insertAdjacentElement("afterBegin",i)}C(function(){d(i).bind("load",
function(){var b=i.contentWindow;f=typeof b[q]!=w?b[q]:"";if(f!=u()){E(h);c.hash=I(f,k)}});typeof i.contentWindow[q]==w&&X()},50)}else if(A){if(m<418){d(j.body).append('<form id="'+q+'" style="position:absolute;top:-9999px;" method="get"></form>');M=j.getElementById(q)}if(typeof c[q]==w)c[q]={};if(typeof c[q][c.pathname]!=w)v=c[q][c.pathname].split(",")}C(function(){z("init");E(h)},1);if(s&&m>7||!s&&"on"+G in o)if(o.addEventListener)o.addEventListener(G,F,false);else o.attachEvent&&o.attachEvent("on"+
G,F);else ca(F,50);d("a[rel*=address:]").address()}},da=function(){if(o.removeEventListener)o.removeEventListener(G,F,false);else o.detachEvent&&o.detachEvent("on"+G,F)},q="jQueryAddress",K="function",w="undefined",G="hashchange",k=true,h=false,n=d.browser,m=parseFloat(d.browser.version),$=n.mozilla,s=n.msie,r=n.opera,A=n.safari,N=h,o=function(){try{return top.document!==undefined?top:window}catch(a){return window}}(),j=o.document,D=o.history,c=o.location,ca=setInterval,C=setTimeout,H=decodeURI,S=
encodeURI;n=navigator.userAgent;var i,M,x=V(document),aa=x?x.indexOf("?"):-1,ea=j.title,B=D.length,J=h,Y=h,O=k,ba=k,L=h,v=[],f=u(),l={autoUpdate:k,history:k,strict:k};if(s){m=parseFloat(n.substr(n.indexOf("MSIE")+4));if(j.documentMode&&j.documentMode!=m)m=j.documentMode!=8?7:8}if(N=$&&m>=1||s&&m>=6||r&&m>=9.5||A&&m>=312){for(n=1;n<B;n++)v.push("");v.push(f);if(s&&c.hash!=f)c.hash="#"+I(f,k);if(r)history.navigationMode="compatible";if(x&&aa!=-1){x=x.substr(aa+1).split("&");for(n=0;n<x.length;n++){r=
x[n].split("=");if(/^(autoUpdate|history|strict)$/.test(r[0]))l[r[0]]=isNaN(r[1])?/^(true|yes)$/i.test(r[1]):parseInt(r[1],10)!==0;if(/^tracker$/.test(r[0]))l[r[0]]=r[1]}}document.readyState=="complete"&&Z();d(Z);d(window).bind("unload",da)}else if(!N&&c.href.indexOf("#")!=-1||A&&m<418&&c.href.indexOf("#")!=-1&&c.search!=""){j.open();j.write('<html><head><meta http-equiv="refresh" content="0;url='+c.href.substr(0,c.href.indexOf("#"))+'" /></head></html>');j.close()}else W();return{init:function(a,
b){return t("init",a,b)},change:function(a,b){return t("change",a,b)},internalChange:function(a,b){return t("internalChange",a,b)},externalChange:function(a,b){return t("externalChange",a,b)},baseURL:function(){var a=c.href;if(a.indexOf("#")!=-1)a=a.substr(0,a.indexOf("#"));if(a.substr(a.length-1)=="/")a=a.substr(0,a.length-1);return a},strict:function(a){if(a!==undefined){l.strict=a;return this}return l.strict},autoUpdate:function(a){if(a!==undefined){l.autoUpdate=a;return this}return l.autoUpdate},
update:function(){L=k;this.value(f);L=h;return this},history:function(a){if(a!==undefined){l.history=a;return this}return l.history},tracker:function(a){if(a!==undefined){l.tracker=a;return this}return l.tracker},title:function(a){if(a!==undefined){a=H(a);C(function(){ea=j.title=a;if(ba&&i&&i.contentWindow&&i.contentWindow.document){i.contentWindow.document.title=a;ba=h}if(!O&&$)c.replace(c.href.indexOf("#")!=-1?c.href:c.href+"#");O=h},50);return this}return j.title},value:function(a){if(a!==undefined){a=
S(H(U(a,k)));if(a=="/")a="";if(f==a&&!L)return;O=k;f=a;if(l.autoUpdate||L){J=k;E(k);v[D.length]=f;if(A)if(l.history){c[q][c.pathname]=v.toString();B=D.length+1;if(m<418){if(c.search==""){M.action="#"+f;M.submit()}}else if(m<523||f==""){a=j.createEvent("MouseEvents");a.initEvent("click",k,k);var b=j.createElement("a");b.href="#"+f;b.dispatchEvent(a)}else c.hash="#"+f}else c.replace("#"+f);else if(f!=u())if(l.history)c.hash="#"+I(f,k);else c.replace("#"+f);s&&m<8&&l.history&&C(X,50);if(A)C(function(){J=
h},1);else J=h}return this}if(!N)return null;return H(U(I(f,h),h))},path:function(a){if(a!==undefined){var b=this.queryString();this.value(a+(b?"?"+b:""));return this}a=this.value();return a.indexOf("?")!=-1?a.split("?")[0]:a},queryString:function(a){if(a!==undefined){this.value(this.path()+(a?"?"+a:""));return this}a=this.value();var b=a.indexOf("?");if(b!=-1&&b<a.length)return a.substr(b+1)},parameter:function(a,b,g){var e,p;if(b!==undefined){var P=this.parameterNames();p=[];for(e=0;e<P.length;e++){var Q=
P[e],y=this.parameter(Q);if(typeof y=="string")y=[y];if(Q==a)y=b===null||b==""?[]:g?y.concat([b]):[b];for(var R=0;R<y.length;R++)p.push(Q+"="+y[R])}d.inArray(a,P)==-1&&p.push(a+"="+b);this.queryString(p.join("&"));return this}b=this.value();e=b.indexOf("?");if(e!=-1){b=b.substr(e+1);p=b.split("&");b=[];for(e=0;e<p.length;e++){g=p[e].split("=");g[0]==a&&b.push(g[1])}if(b.length!==0)return b.length!=1?b:b[0]}},pathNames:function(){var a=this.path(),b=a.split("/");if(a.substr(0,1)=="/"||a.length===0)b.splice(0,
1);a.substr(a.length-1,1)=="/"&&b.splice(b.length-1,1);return b},parameterNames:function(){var a=this.value(),b=a.indexOf("?"),g=[];if(b!=-1){a=a.substr(b+1);if(a!=""&&a.indexOf("=")!=-1){a=a.split("&");for(b=0;b<a.length;b++){var e=a[b].split("=")[0];d.inArray(e,g)==-1&&g.push(e)}}}return g}}}();d.fn.address=function(z){var t=function(){var u=z?z.call(this):/address:/.test(d(this).attr("rel"))?d(this).attr("rel").split("address:")[1].split(" ")[0]:d(this).attr("href").replace(/^#/,"");d.address.value(u);
return false};d(this).click(t).live("click",t)}})(jQuery);
